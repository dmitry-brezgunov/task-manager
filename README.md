# Task Manager API
## Описание
Персонализированный сервис task manager, позволяющий пользователю ставить себе задачи, отражать в системе изменение их статуса и просматривать историю задач.

## Стек
Python, Django, DjangoRestFramework, Django-Filter, Gunicorn, Docker, PostgreSQL

## Функциональные возможности
- Пользователь может зарегистрироваться в сервисе задав пару логин-пароль
- В системе может существовать много пользователей
- Пользователь может авторизоваться в сервисе предоставив пару логин-пароль и получив в ответе токен
- Пользователь видит только свои задачи
- Пользователь может создать себе задачу. Задача содержит следующие данные:

(*) - обязательные поля

  1. *Название (поле title)
  2. *Описание (поле description)
  3. *Время создания (поле add_date)
  4. *Статус (поле status). Возможные опции на выбор: Новая (NEW), Запланированная (PLANNED), В работе (IN_WORK), Завершённая (COMPLETED);
  5. Планируемая дата завершения (поле completion_date) в формате `%d-%m-%Y %H:%M`

- Пользователь может менять статус задачи на любой из данного набора
- Пользователь может менять планируемое время завершения, название и описание
- Нельзя поставить планируемую дату завершения задачи раньше текущей при создании задачи или раньше времени создания задачи при редактировании задачи
- Пользователь может получить список своих задач, с возможностью фильтрации по статусу и планируемому времени завершения
- Пользователь может просмотреть историю изменений задачи

## Запуск проекта
На локальном компьютере должен быть установлен Docker.

1. Склонировать данный репозиторий на свой локальный компьютер.
2. В корневой директории создать файл .env и прописать в нем переменные окружения:
```
DB_ENGINE=django.db.backends.postgresql
DB_NAME=postgres
DB_PASSWORD=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
DB_HOST=db
DB_PORT=5432
SECRET_KEY=<секретный ключ Django проекта>
```
3. В терминале в корневой директории приложения выполнить команду `docker-compose up`.
4. После запуска контейнера в новой вкладке терминала выполнить команду `docker container ls` и узнать id контейнера.
5. Перейти в контейнер выполнив команду `docker container exec -it <id контейнер> bash`.
6. Внутри контейнера выполнить команду `python manage.py migrate`.
7. Выполнить тесты командой `python manage.py test`.

Приложение будет доступно на локальном сервере - http://127.0.0.1:8000/

## Доступные методы API

Endpoint | Методы | Описание
------------ | ------------- | -------------
api/register/ | POST | Регистрация нового пользователя. В теле запроса необходимо передать username и password
api/token/ | POST | Получение токена зарегистрированным пользователем. В теле запроса необходимо передать username и password
api/tasks/ | GET, POST | GET запрос для получения списка задач пользователя (с пагинацией), доступна фильтрация по статусу и планируемой дате звершения. POST запрос для создания новой задачи. Обязательны к заполнению поля title и description, add_date заполняется автоматически текущем временем. Поле status при создании по умолчанию с опцией NEW, если пользователь не указал это поле при создании задачи.
api/tasks/{int:id}/ | GET, PUT, PATCH, DELETE | Получить, изменить, удалить задачу по id
api/tasks/{int:id}/history/ | GET | Вернет список всех состояний задачи (с пагинацией), с дополнительным полем edit_time (дата изменения задачи)

## Примеры запросов
**Создание новой задачи:**
```
import requests
 
url = 'http://127.0.0.1/api/tasks/'
data = {
     'title': 'Новая задача',
     'description': 'Описание задачи',
     'status': 'IN_WORK',
     'completion_date': '30-10-2020 17:00'
 }
headers = {'Authorization': 'Token <ваш_токен>'}
r = requests.post(url, data=data,  headers=headers)
```
Просмотр списка, отдельной задачи, создание, редактирование, удаление доступны только зарегистрированным пользователям предоставившим токен. Пользователь имеет доступ только к своим задачам.

**Фильтрация списка задач:**
```
import requests
 
url = 'http://127.0.0.1/api/tasks/'
params = {
     'status': 'IN_WORK',
     'date_from': '01-10-2020 17:00',
     'date_to': '30-10-2020 17:00'
 }
headers = {'Authorization': 'Token <ваш_токен>'}
r = requests.get(url, params=params,  headers=headers)
```
Список задач можно фильтровать по статусу и планируемой дате завершения. Для это в параметрах get запроса нужно передать 'status', 'date_from' для фильтрации задач с датой выполнения больше или равной указанной, 'date_to' для фильтрации задач с датой выполнения меньше или равной указанной. Принимаемые форматы даты: `%d-%m-%Y` или `%d-%m-%Y %H:%M`
